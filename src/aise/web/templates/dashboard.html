{% extends "layout.html" %}
{% block content %}
<section id="dashboard-page" class="split">
  <article class="card">
    <h2>新建项目</h2>
    <form id="create-project-form" method="post" action="/projects" class="stack">
      <label>项目名称</label>
      <input name="project_name" required placeholder="例如: UserAPI">
      <label>开发模式</label>
      <select name="development_mode">
        <option value="local" {% if global_config_data.development_mode == "local" %}selected{% endif %}>Local</option>
        <option value="github" {% if global_config_data.development_mode == "github" %}selected{% endif %}>GitHub</option>
      </select>
      <label>初始需求（可选，填写后创建即执行工作流）</label>
      <textarea name="initial_requirement" rows="4" placeholder="例如：构建一个用户管理 API"></textarea>
      <h3>Agent 模型选择</h3>
      <div id="agent-model-grid" class="agent-grid">
        {% for agent in global_config_data.available_agents %}
        <label>{{ agent }}</label>
        <select name="agent_model_{{ agent }}" data-agent-model="{{ agent }}">
          {% for item in global_config_data.model_catalog %}
          {% set selected_model = global_config_data.agent_model_selection.get(agent, "") %}
          <option value="{{ item.id }}"
            {% if selected_model == item.id or (not selected_model and item.default) %}selected{% endif %}>
            {{ item.id }}{% if item.default %} (default){% endif %}
          </option>
          {% endfor %}
        </select>
        {% endfor %}
      </div>
      <button class="btn" type="submit">创建项目</button>
    </form>
  </article>
  <article class="card">
    <h2>工作台概览</h2>
    <p>项目数: <strong id="project-count">{{ projects|length }}</strong></p>
    <div class="auth-grid">
      <a class="btn secondary" href="/config/global/models">模型配置</a>
      <a class="btn secondary" href="/config/global/agents">Agent配置</a>
    </div>
  </article>
</section>

<section class="card">
  <h2>项目概览</h2>
  <div id="project-cards" class="project-cards">
    {% if projects %}
    {% for p in projects %}
    <a class="project-card" href="/projects/{{ p.project_id }}">
      <h3>{{ p.project_name }}</h3>
      <p>ID: {{ p.project_id }}</p>
      <p>状态: {{ p.status }}</p>
      <p>模式: {{ p.development_mode }}</p>
      <p>Agent 数: {{ p.agent_count }}</p>
      <p>更新时间: {{ p.updated_at }}</p>
    </a>
    {% endfor %}
    {% else %}
    <p>暂无项目，先创建一个。</p>
    {% endif %}
  </div>
</section>
{% endblock %}
